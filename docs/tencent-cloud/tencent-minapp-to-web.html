<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>简单几步，让微信小程序变身 H5 网页 · 头像小册</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="云开发（Tencent Cloud Base，TCB）是腾讯云为移动开发者提供的一站式后端云服务，它帮助开发者统一构建和管理资源，免去了移动应用开发过程中繁琐的服务器搭建及运维、域名注册及备案、数据接口实现等繁琐流程，让开发者可以专注于业务逻辑的实现，而无需理解后端逻辑及服务器运维知识，开发门槛更低，效率更高。"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="简单几步，让微信小程序变身 H5 网页 · 头像小册"/><meta property="og:type" content="website"/><meta property="og:url" content="https://hi-our.github.io//hi-face/"/><meta property="og:description" content="云开发（Tencent Cloud Base，TCB）是腾讯云为移动开发者提供的一站式后端云服务，它帮助开发者统一构建和管理资源，免去了移动应用开发过程中繁琐的服务器搭建及运维、域名注册及备案、数据接口实现等繁琐流程，让开发者可以专注于业务逻辑的实现，而无需理解后端逻辑及服务器运维知识，开发门槛更低，效率更高。"/><meta property="og:image" content="https://hi-our.github.io//hi-face/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://hi-our.github.io//hi-face/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/hi-face/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/hi-face/js/scrollSpy.js"></script><link rel="stylesheet" href="/hi-face/css/main.css"/><script src="/hi-face/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/hi-face/"><img class="logo" src="/hi-face/img/favicon.ico" alt="头像小册"/><h2 class="headerTitleWithLogo">头像小册</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/hi-face/docs/introduction" target="_self">头像小册</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>腾讯云开发实战</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">介绍<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/hi-face/docs/introduction">开篇介绍</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/book-plan">产品需求设计、项目规划、UI设计的技巧</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">配置<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/hi-face/docs/config/taro-cloud-function">项目搭建-Taro小程序开启云开发模式</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/config/tencent-cloud-ai-face">项目搭建-腾讯云环境配置及特色人工功能介绍</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">小程序知识<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/hi-face/docs/minapp-knowledge/canvas-image-cropper-share">图片裁剪、模糊、保存、分享的技巧</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/minapp-knowledge/canvas-minapp-web">canvas在小程序与web端的不同</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/minapp-knowledge/minapp-to-dark-mode">深色模式在Web端的适配技巧，附带小程序侧的思考</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">原生小程序实战<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/hi-face/docs/minapp-native/face-recognition">原生微信小程序实现人脸识别</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/minapp-native/sticker">原生微信小程序实现头像大头贴效果</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/minapp-native/wear-a-mask">原生小程序实现戴口罩或圣诞帽</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">腾讯云开发实战<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/picture-speed-up-1-second">图片识别加速，从10秒变为1秒，是怎么做到的呢？</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/hi-face/docs/tencent-cloud/tencent-minapp-to-web">简单几步，让微信小程序变身 H5 网页</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/image-extension-introduction">多种云开发扩展能力，让人脸识别飞起来</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/picture-recognition-storage">借助云存储，让大图识别转换真正加速</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/avatar-poster-share">海报分享页面的小程序和web端</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/login-minapp-web">小程序与Web端的账户体系摸索</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/self-page-list">个人中心的制作，包含登录组件的小程序和web端</a></li><li class="navListItem"><a class="navItem" href="/hi-face/docs/tencent-cloud/tencent-image-services">腾讯云功能</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Taro实战<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/hi-face/docs/taro-next/taro-next-vs-core">小程序框架：Taro 2.0与Taro 3.0的核心分析</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">简单几步，让微信小程序变身 H5 网页</h1></header><article><div><span><p>云开发（Tencent Cloud Base，TCB）是腾讯云为移动开发者提供的一站式后端云服务，它帮助开发者统一构建和管理资源，免去了移动应用开发过程中繁琐的服务器搭建及运维、域名注册及备案、数据接口实现等繁琐流程，让开发者可以专注于业务逻辑的实现，而无需理解后端逻辑及服务器运维知识，开发门槛更低，效率更高。</p>
<p>官方教程：<a href="https://tencentcloudbase.github.io/">https://tencentcloudbase.github.io/</a></p>
<h2><a class="anchor" aria-hidden="true" id="web-端调用云开发"></a><a href="#web-端调用云开发" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web 端调用云开发</h2>
<h3><a class="anchor" aria-hidden="true" id="开通步骤"></a><a href="#开通步骤" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>开通步骤</h3>
<ol>
<li>先开通小程序的云开发环境，若已开通，此步骤可忽略。</li>
<li>访问<a href="https://console.cloud.tencent.com/tcb">腾讯云云开发</a>，以“微信公众号”进行登录，授权所需小程序即可登录。（每个小程序对应着独立的腾讯云账号，当然也可以在腾讯云的账号上绑定唯一的一个小程序。）</li>
<li>在“用户管理=&gt;登录设置”开通“匿名登录”。（我的目标是跑通Web端，所以此处并未对完整登录校验做深入讨论。）</li>
</ol>
<blockquote>
<p>如果有疑问，可以在腾讯云上提工单，工单的回复速度比较快。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="配置方法"></a><a href="#配置方法" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置方法</h3>
<p><strong>方案一：Script引入</strong></p>
<p>适合普通网页使用</p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"//imgcache.qq.com/qcloud/tcbjs/1.3.8/tcb.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">
  <span class="hljs-keyword">var</span> app = tcb.init({
    env: <span class="hljs-string">'development-v9y2f'</span>
  })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>以npm 引入</strong></p>
<p>云开发可以通过 tcb-js-sdk 来访问：</p>
<pre><code class="hljs css language-js">npm install --save tcb-js-sdk@latest
</code></pre>
<p>要在你的模块式使用模块可以</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> tcb = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tcb-js-sdk'</span>);
</code></pre>
<p>或</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> tcb <span class="hljs-keyword">from</span> <span class="hljs-string">'tcb-js-sdk'</span>;
</code></pre>
<pre><code class="hljs css language-js"><span class="hljs-comment">// 初始化环境</span>
<span class="hljs-keyword">const</span> app = tcb.init({
  <span class="hljs-attr">env</span>: <span class="hljs-string">'你的环境 Id'</span>
});
</code></pre>
<blockquote>
<p><code>tcb-js-sdk</code> 支持多端适配，如微信小程序、Web端、QQ小游戏等，具体可以看 <a href="https://github.com/TencentCloudBase/tcb-js-sdk/blob/master/docs/adapters.md">https://github.com/TencentCloudBase/tcb-js-sdk/blob/master/docs/adapters.md</a></p>
</blockquote>
<p>而我的代码是基于 Taro 跨端框架。</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> tcb <span class="hljs-keyword">from</span> <span class="hljs-string">'tcb-js-sdk'</span>;

componentWillMount() {

  <span class="hljs-comment">// </span>
  <span class="hljs-keyword">if</span> (process.env.TARO_ENV === <span class="hljs-string">'weapp'</span>) {
    Taro.cloud.init({
      <span class="hljs-attr">env</span>: <span class="hljs-string">'环境 ID'</span>
    })
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.env.TARO_ENV === <span class="hljs-string">'h5'</span>) {
    <span class="hljs-comment">// 将TCB绑定到 Taro.coud 上便于全局使用</span>
    <span class="hljs-comment">// 实测 tcb-js-sdk 大部分的 API 与wx.cloud好像一样</span>
    Taro.cloud = tcb.init({
      <span class="hljs-attr">env</span>: <span class="hljs-string">'环境 ID'</span>
    })

    <span class="hljs-comment">// 匿名登录</span>
    Taro.cloud.auth().signInAnonymously().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

      <span class="hljs-comment">// 这里代码可以不写，我是想调用云开发的云函数，来验证是否成功调用。</span>
      Taro.cloud.callFunction({
        <span class="hljs-attr">name</span>: <span class="hljs-string">'thanks-data'</span>,
        <span class="hljs-attr">data</span>: {}
      }).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'thanks-data res'</span>, res))

    }).catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'error :'</span>, error);
    })
  }
}

</code></pre>
<p>这里补充一些关于 Taro 的信息</p>
<p>Taro 是一套遵循 React 语法规范的 多端开发 解决方案。</p>
<p>使用 Taro，我们可以只书写一套代码，再通过 Taro 的编译工具，将源代码分别编译出可以在不同端（微信/百度/支付宝/字节跳动/QQ/京东小程序、快应用、H5、React-Native 等）运行的代码。</p>
<h2><a class="anchor" aria-hidden="true" id="项目开发中所踩的坑"></a><a href="#项目开发中所踩的坑" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目开发中所踩的坑</h2>
<h3><a class="anchor" aria-hidden="true" id="适配过程"></a><a href="#适配过程" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>适配过程</h3>
<p>从微信小程序迁移到Web端，不是一蹴而就的。在我的“快快戴口罩”小程序中，我是基于以下三个页面来完成的：</p>
<ul>
<li>致谢页（pages/thanks/thanks）：调用云函数，让页面正常运转</li>
<li>圣诞帽canvas画图（pages/test/test）：调用云函数，自动在<code>canvas</code>画上人物图片和圣诞帽，完成小程序端与Web端的适配。</li>
<li>口罩页（pages/wear-a-mask/wear-a-mask）：完整流程，包含云开发、UI适配、图片识别及图片生成等。</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="画布功能"></a><a href="#画布功能" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>画布功能</h3>
<p><strong>小程序侧</strong> 所要绘制的图片资源（网络图片要通过 getImageInfo / downloadFile 先下载），也就是说，小程序上所需的是有效的本地图片地址，比如本地路径、代码包路径。</p>
<p><strong>Web端</strong> 需要的是Img元素在onload后，也就是需要将图片加载完后再进行绘制。</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// Web 端，获取图片元素</span>
<span class="hljs-keyword">const</span> getH5Image = <span class="hljs-function">(<span class="hljs-params">src</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> Image()
    image.setAttribute(<span class="hljs-string">'crossOrigin'</span>, <span class="hljs-string">'anonymous'</span>);
    image.src = src
    image.id = <span class="hljs-string">`temp_image_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>;
    image.style.display = <span class="hljs-string">'none'</span>;
    <span class="hljs-built_in">document</span>.body.append(image);
    image.onload = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(image)
    image.onerror = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> reject(image)
  })
}

<span class="hljs-comment">// 获取网络图片</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getImg = <span class="hljs-keyword">async</span> (src) =&gt; {

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (process.env.TARO_ENV === <span class="hljs-string">'h5'</span>) {
      <span class="hljs-keyword">let</span> image = <span class="hljs-keyword">await</span> getH5Image(src)
      <span class="hljs-keyword">return</span> image
    }

    <span class="hljs-keyword">if</span> (src.includes(<span class="hljs-string">';base64,'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> base64src(src)
    }

    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> Taro.getImageInfo({
      src
    })
    <span class="hljs-keyword">return</span> res.path
    
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'error :'</span>, error);
    <span class="hljs-keyword">throw</span> error
    
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="样式适配"></a><a href="#样式适配" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>样式适配</h3>
<p>Taro H5版本上少了一些样式适配。</p>
<pre><code class="hljs css language-html"><span class="hljs-comment">&lt;!-- index.html 加入iPhone X适配--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>&gt;</span>
</code></pre>
<pre><code class="hljs css language-css"><span class="hljs-selector-tag">html</span> <span class="hljs-selector-id">#app</span> <span class="hljs-selector-class">.taro_page</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}
<span class="hljs-selector-tag">html</span> <span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">width</span>: auto;
  <span class="hljs-attribute">border</span>: none;
}
<span class="hljs-selector-tag">html</span> <span class="hljs-selector-class">.taro-text</span> {
  <span class="hljs-attribute">white-space</span>: pre-line;
}
<span class="hljs-comment">/* iPhone x异形屏适配 */</span>
<span class="hljs-selector-tag">html</span> <span class="hljs-selector-class">.taro-tabbar__tabbar-bottom</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-built_in">calc</span>(env(safe-area-inset-bottom) / <span class="hljs-number">3</span>);
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="功能隐藏"></a><a href="#功能隐藏" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>功能隐藏</h3>
<blockquote>
<p>小程序特有，Web端缺失</p>
</blockquote>
<p><strong>分享给朋友 <code>Button</code></strong></p>
<pre><code class="hljs css language-html"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'share-btn'</span> <span class="hljs-attr">openType</span>=<span class="hljs-string">'share'</span>&gt;</span>分享给朋友<span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'share-btn-icon'</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
</code></pre>
<p><strong>图片压缩 <code>wx.compressImage</code></strong></p>
<h3><a class="anchor" aria-hidden="true" id="文章相关内容："></a><a href="#文章相关内容：" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文章相关内容：</h3>
<blockquote>
<p>珍爱生命，从我做起，快点戴上口罩，给大家介绍我开源的 Taro + 腾讯云开发 小程序「快快戴口罩」它可以智能识别人脸，给集体照戴上口罩。(*￣︶￣)</p>
</blockquote>
<p>采用 <code>Taro</code> 跨端框架，采用腾讯云开发模式，采用基于腾讯云的五官分析的人脸识别，实现了自动为头像戴上口罩的功能。</p>
<p>源码地址：</p>
<p><a href="https://github.com/shenghanqin/quickly-mask" title="https://github.com/shenghanqin/quickly-mask">https://github.com/shenghanqin/quickly-mask</a></p>
<p>我是 <strong>盛瀚钦</strong>，沪江 CCtalk 前端开发工程师，Taro 框架的 issue 维护志愿者，主要侧重于前端 UI 编写和团队文档建设。</p>
<p><strong>主要功能</strong></p>
<ul>
<li>智能识别人脸，进行五官定位</li>
<li>支持多人识别，并戴上口罩</li>
<li>以后会增加多种节日的效果</li>
</ul>
<p><strong>扫码预览</strong></p>
<p>微信搜一搜：快快戴口罩</p>
<p><img src="https://n1image.hjfile.cn/res7/2020/02/02/e40fff62cb635dd9be797226f7c266ed.png" alt=""></p>
<h2><a class="anchor" aria-hidden="true" id="小程序截图"></a><a href="#小程序截图" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序截图</h2>
<p><img src="https://n1other.hjfile.cn/res7/2020/02/10/1b0add271a294e2bf1140d124eaf595b.JPG" alt=""></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/hi-face/docs/tencent-cloud/picture-speed-up-1-second"><span class="arrow-prev">← </span><span>图片识别加速，从10秒变为1秒，是怎么做到的呢？</span></a><a class="docs-next button" href="/hi-face/docs/tencent-cloud/image-extension-introduction"><span>多种云开发扩展能力，让人脸识别飞起来</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#web-端调用云开发">Web 端调用云开发</a><ul class="toc-headings"><li><a href="#开通步骤">开通步骤</a></li><li><a href="#配置方法">配置方法</a></li></ul></li><li><a href="#项目开发中所踩的坑">项目开发中所踩的坑</a><ul class="toc-headings"><li><a href="#适配过程">适配过程</a></li><li><a href="#画布功能">画布功能</a></li><li><a href="#样式适配">样式适配</a></li><li><a href="#功能隐藏">功能隐藏</a></li><li><a href="#文章相关内容：">文章相关内容：</a></li></ul></li><li><a href="#小程序截图">小程序截图</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/hi-face/" class="nav-home"><img src="/hi-face/img/favicon.ico" alt="头像小册" width="66" height="58"/></a><div><h5>Docs</h5><a href="/hi-face/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/hi-face/docs/en/doc2.html">Guides (or other categories)</a><a href="/hi-face/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/hi-face/en/users.html">User Showcase</a><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/hi-face/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/hi-face/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Hi Our</section></footer></div></body></html>